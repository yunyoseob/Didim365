# β¨ SpringBoot νν—¤μΉκΈ°

π« κ°•μ μ†κ°

```
μ¤ν”„λ§ λ¶€νΈμ ν•µμ‹¬ κΈ°λ¥μ„ μ½”λ“λ΅ μ§μ ‘ κµ¬ν„ν•λ©΄μ„ μ¤ν”„λ§ λ¶€νΈμ λ™μ‘ μ›λ¦¬μ™€ μ¤ν”„λ§ λ¶€νΈμ— μ μ©λ μ¤ν”„λ§ ν”„λ μ„μ›ν¬μ ν™μ©λ²•μ„ μµνκ² λλ” κ°•μ
```

π“ λ©μ°¨

```
4.  μλ™ κµ¬μ„± κΈ°λ° μ• ν”λ¦¬μΌ€μ΄μ… λ° μ΅°κ±΄λ¶€ μλ™ κµ¬μ„±
    - 4-1. λ©”νƒ€ μ–΄λ…Έν…μ΄μ…
    - 4-2. μλ™ κµ¬μ„± μ •λ³΄ νμΌ λ¶„λ¦¬ λ° 
            μ–΄λ…Έν…μ΄μ… μ μ©
    - 4.3. @Configurationκ³Ό 
            proxyBeanMethods
    - 4-4. @Conditionalκ³Ό Condition

5. μ™Έλ¶€ μ„¤μ •μ„ μ΄μ©ν• μλ™κµ¬μ„±
    - 6-1. μλ™ κµ¬μ„±μ— Environment  
            property μ μ©
    - 6-2. @Valueμ™€ PropertySourcesPlaceholderConfigurer

6. μ¤ν”„λ§λ¶€νΈ μλ™ κµ¬μ„± μ‚΄ν΄λ³΄κΈ°
    - 7-1. μλ™ κµ¬μ„± λ¶„μ„ λ°©λ²•
    - 7-2. Web μλ™ κµ¬μ„± μ‚΄ν΄λ³΄κΈ°
```


# 4. μλ™ κµ¬μ„± κΈ°λ° μ• ν”λ¦¬μΌ€μ΄μ…

Spring Bootμ μ–΄λ…Έν…μ΄μ… ν™μ©μ— μ•μ„μ„ μ¤ν”„λ§μ κΈ°λ³Έμ μΈ μ–΄λ…Έν…μ΄μ…μ€ μ•„λμ™€ κ°™λ‹¤.

![image](https://user-images.githubusercontent.com/81727895/236685165-31855dec-c59b-4731-8193-90f4ea32c61a.png)


## **4-1. λ©”νƒ€ μ–΄λ…Έν…μ΄μ…**

μ–΄λ…Έν…μ΄μ…μ— μ μ©ν• μ–΄λ…Έν…μ΄μ…μ„ λ©”νƒ€ μ–΄λ…Έν…μ΄μ…μ΄λΌκ³  ν•λ‹¤.

### **4-1-1. λ©”νƒ€ μ–΄λ…Έν…μ΄μ… μ‚΄ν΄λ³΄κΈ°**

>  **SimpleHelloService.java**

```java
@Service
public class SimpleHelloService implements HelloService{
   ...
}
```

**β”οΈ @Service μ–΄λ…Έν…μ΄μ… κµ¬μ„± λ³΄κΈ°**

```java
@Target({ElementType.TYPE})
@Retention(RetentionPolicy.RUNTIME)
@Documented
@Component
public @interface Service {
    @AliasFor(
        annotation = Component.class
    )
    String value() default "";
}
```

μ—¬κΈ°μ„, @Servicesλ” @Component μ–΄λ…Έν…μ΄μ…μ λ©”νƒ€ μ–΄λ…Έν…μ΄μ…μ„μ„ μ• μ μλ‹¤.


>  **HelloController.java**

```java
@RestController
public class HelloController {
    ...
}
```

**β”οΈ @RestController κµ¬μ„± λ³΄κΈ°**

```java
@Target({ElementType.TYPE})
@Retention(RetentionPolicy.RUNTIME)
@Documented
@Controller
@ResponseBody
public @interface RestController {
    @AliasFor(
        annotation = Controller.class
    )
    String value() default "";
}
```

HelloController ν΄λμ¤ μ„μ— μλ” @RestControllerλ” @Controllerμ™€ @ResponseBodyμ λ©”νƒ€ μ–΄λ…Έν…μ΄μ…μ΄λ‹¤.


**β”οΈ @Controller κµ¬μ„± λ³΄κΈ°**

```java
@Target({ElementType.TYPE})
@Retention(RetentionPolicy.RUNTIME)
@Documented
@Component
public @interface Controller {
    @AliasFor(
        annotation = Component.class
    )
    String value() default "";
}
```

RestController @interfaceμ„μ Controllerλ” @Componentμ λ©”νƒ€ μ–΄λ…Έν…μ΄μ…μ΄λ‹¤.

μ΄λ¥Ό κ·Έλ¦ΌμΌλ΅ ν‘ν„ν•λ©΄ μ•„λμ™€ κ°™λ‹¤.

![image](https://user-images.githubusercontent.com/81727895/236685498-04595be5-6c5b-488d-a4d2-9e84191fe1e6.png)

**β”οΈ Composed annotation(ν•©μ„± μ• λ…Έν…μ΄μ…)**

μ΄λ ‡κ² λ©”νƒ€ μ• λ…Έν…μ΄μ…μ„ ν•λ‚ μ΄μƒ μ μ©ν•΄μ„ λ§λ“  μ• λ…Έν…μ΄μ…μ„ ν•©μ„± μ• λ…Έν…μ΄μ…μ΄λΌκ³  ν•λ‹¤.

ν΄λμ¤λ‚ λ©”μ„λ“μ— λ¶€μ—¬ν•λ” μ–΄λ…Έν…μ΄μ…μ΄ κ°€μ§€κ³  μλ” λ¨λ“  λ©”νƒ€ μ–΄λ…Έν…μ΄μ…μ΄ μ μ©λμ–΄ μλ” κ²ƒκ³Ό κ°™λ‹¤.


**π¤” κΈ°μ΅΄μ— μλ” μ–΄λ…Έν…μ΄μ…λ§ μ‚¬μ©ν•΄λ„ λ  κ²ƒ κ°™μ€λ°, κµ³μ΄ λ©”νƒ€ μ–΄λ…Έν…μ΄μ…μ„ μ‚¬μ©ν•λ” μ΄μ λ”?**

```
1.  κ°λ°μκ°€ μ½”λ“λ¥Ό μ½μ„ λ•, ν•΄λ‹Ή ν΄λμ¤κ°€ μ¤ν”„λ§ λΉμΌλ΅ λ“±λ΅λλ” μ§€ νμ•…ν•¨κ³Ό λ™μ‹μ— μ–΄λ…Έν…μ΄μ…μ κΈ°λ¥κ³Ό μ—­ν• μ— λ€ν• μ¶”κ°€μ μΈ μ •λ³΄λ¥Ό μ–»μ„ μ μλ‹¤

2. μ–΄λ…Έν…μ΄μ…μ— μμ–΄μ„ λ‹¤λ¥Έ λ¶€κ°€μ μΈ κΈ°λ¥ λ° ν¨κ³Όλ¥Ό κΈ°λ€ν•  μ μλ‹¤.
```


### **4-1-2. λ©”νƒ€ μ–΄λ…Έν…μ΄μ… ν™μ© μμ **

- HelloServiceTest.java

```java
package tobyspring.helloboot;

import org.junit.jupiter.api.Test;
...
import static org.assertj.core.api.Assertions.assertThat;

public class HelloServiceTest {
    @Test
    void simpleHelloService(){
        System.out.println("==== simpleHelloService ====");
        SimpleHelloService helloService = new SimpleHelloService();

        String ret = helloService.sayHello("Test");
        assertThat(ret).isEqualTo("Simple HelloTest");
    }

    @Test
    void complexHelloService(){
        System.out.println("==== complexHelloService ====");
        ComplexHelloService helloService = new ComplexHelloService();

        String ret = helloService.sayHello("Test");
        assertThat(ret).isEqualTo("Complex HelloTest");
    }
}
```

- μ¶λ ¥ κ²°κ³Ό(ν…μ¤νΈ μ΄μƒ μ—†μ)

```
==== simpleHelloService ====
==== complexHelloService ====
```

Test μ–΄λ…Έν…μ΄μ…μ„ λ¶™μ—¬μ¤μΌλ΅μ¨ Test κΈ°λ¥μ„μ„ νμ•…ν•  μ μμΌλ‚, μ–΄λ–¤ ν…μ¤νΈμΈμ§€ μ•κΈ° μ„ν•΄, λ©”νƒ€ μ–΄λ…Έν…μ΄μ…μ„ λ§λ“ λ‹¤κ³  κ°€μ •ν•μ.

μ΄ λ•, μ„μλ΅ UnitTestλΌλ” λ©”νƒ€ μ–΄λ…Έν…μ΄μ…μ„ λ§λ“¤μ–΄μ„ μ‹¤ν–‰ν•  μ μλ‹¤.

```java
// @Retentionκ³Ό @Targetμ€ λ°λ“μ‹ λ¶™μ—¬μ¤μ•Ό ν•λ” ν•„μ μµμ…μ΄λ‹¤.
@Retention(RetentionPolicy.RUNTIME)
@Target(ElementType.METHOD) 
/* 
@Target({ElementType.ANNOTATION_TYPE, ElementType.METHOD})μΌλ΅ μ‘μ„±ν•  κ²½μ°, λ‹¤λ¥Έ μ–΄λ…Έν…μ΄μ…μ΄ @UnitTest μ–΄λ…Έν…μ΄μ…μ„ ν™μ©ν•  μ μλ‹¤. */
@Test 
/* @Test μ–΄λ…Έν…μ΄μ…μ΄ μ—†μΌλ©΄, @UnitTestκ°€ @Testμ λ©”νƒ€ μ–΄λ…Έν…μ΄μ…μΈμ§€ μ• μ μ—†μΌλ―€λ΅, λ„£μ–΄μ£Όμ–΄μ•Ό ν•λ‹¤. */
@interface UnitTest{}

public class HelloServiceTest {
    @UnitTest
    void simpleHelloService(){
        ...
    }

    @Test
    void complexHelloService(){
        ...
    }
}
```

## **4-2. μλ™ κµ¬μ„± μ •λ³΄ νμΌ λ¶„λ¦¬ λ° μ–΄λ…Έν…μ΄μ… μ μ©**

μ•μ„, ν…μ¤νΈ λ΅μ§μ„ ν†µν•΄ λ©”νƒ€ μ–΄λ…Έν…μ΄μ…μ„ ν™μ©ν•λ” μμ‹λ¥Ό μ‘μ„±ν–λ‹¤λ©΄, μ΄λ²μ—λ” λ©”νƒ€ μ• λ…Έν…μ΄μ…μ„ ν†µν•΄ μλ™ κµ¬μ„± μ •λ³΄λ¥Ό λ¶„λ¦¬ν•΄λ³΄λ„λ΅ ν•λ‹¤.

### **4-2-1. λ©”νƒ€ μ• λ…Έν…μ΄μ… μƒμ„±, Config ν΄λμ¤ μƒμ„±ν•κΈ°**

- RwkSpringBootAnnotation μ• λ…Έν…μ΄μ… μƒμ„±ν•κΈ°

```java
@Retention(RetentionPolicy.RUNTIME)
@Target(ElementType.TYPE)
@Configuration
@ComponentScan
public @interface RwkSpringBootAnnotation {
}
```

@Configuration μ–΄λ…Έν…μ΄μ…κ³Ό @ComponentScan μ–΄λ…Έν…μ΄μ…μ λ©”νƒ€ μ–΄λ…Έν…μ΄μ…μ„ μƒμ„±ν•μ€λ‹¤.

@Configuration μ–΄λ…Έν…μ΄μ…μ κ²½μ° @Bean μ–΄λ…Έν…μ΄μ…μ΄ ν•„μμΈλ°, μ΄λ¥Ό Config ν΄λμ¤μ— λ¶„λ¦¬μ‹ν‚¤λ„λ΅ ν•λ‹¤.

- Config.java

```java
...
public class Config {
    @Bean
    public ServletWebServerFactory servletWebServerFactory(){
        System.out.println("======== ServletWebServerFactory register =========");
        return new TomcatServletWebServerFactory();
    }

    @Bean
    public DispatcherServlet dispatcherServlet(){
        System.out.println("======== DispatcherServlet register =========");
        return new DispatcherServlet();
    }
}
```

- HelloBootApplication.java

```java
@RwkSpringBootAnnotation
public class HelloBootApplication {
    public static void main(String[] args){
        SpringApplication.run(HelloBootApplication.class, args);
    }
}
```

μ¤ν”„λ§ λ¶€νΈλ¥Ό λ‹¤μ‹ μ‹¤ν–‰ μ‹μΌλ³΄λ©΄ Config ν΄λμ¤μ— μλ” Beanμ„ μ¤μΊ”ν•λ” κ²ƒμ„ μ• μ μλ‹¤.

- μ¶λ ¥ κ²°κ³Ό

```
...
======== ServletWebServerFactory register =========
...
======== DispatcherServlet register =========
...
```

### **4-2-2. λΉ μ¤λΈμ νΈμ™€ μ—­ν• κ³Ό κµ¬λ¶„**

![image](https://user-images.githubusercontent.com/81727895/236689845-03b514ed-51ba-4367-9134-690f761227a1.png)


μ¤ν”„λ§ μ»¨ν…μ΄λ„κ°€ μƒμ„±ν•κ³  κ΄€λ¦¬ν•λ” λΉμ€ ν¬κ² μ• ν”λ¦¬μΌ€μ΄μ… λ΅μ§ λΉ, μ• ν”λ¦¬μΌ€μ΄μ… μΈν”„λΌμ¤νΈλ­μ² λΉ, μ»¨ν…μ΄λ„ μΈν”„λΌμ¤νΈλ­μ² λΉμΌλ΅ λ‚λ μ μλ‹¤.

**1. μ• ν”λ¦¬μΌ€μ΄μ… λ΅μ§ λΉ**

μ• ν”λ¦¬μΌ€μ΄μ…μ κΈ°λ¥(λΉ„μ¦λ‹μ¤ λ΅μ§, λ„λ©”μΈ λ΅μ§)μ„ λ‹΄κ³  μλ” λΉ

**2. μ• ν”λ¦¬μΌ€μ΄μ… μΈν”„λΌμ¤νΈλ­μ² λΉ**

κΈ°μ κ³Ό κ΄€λ ¨λ κ²ƒμΌλ΅ μ§μ ‘ μ‘μ„±ν•μ§€ μ•κ³ , μ‚¬μ©ν•κ² λ‹¤κ³  μ‘μ„±ν• λΉ κµ¬μ„±μ •λ³΄

**3. μ»¨ν…μ΄λ„ μΈν”„λΌμ¤νΈλ­μ² λΉ**

μ¤ν”„λ§ μ»¨ν…μ΄λ„ μμ‹  νΉμ€ κΈ°λ¥μ„ ν™•μ¥ν•λ©΄μ„ μ¶”κ°€ν•΄μ¨ κ²ƒλ“¤μ„ λΉμΌλ΅ λ“±λ΅μ‹μΌμ„ μ‚¬μ©


![image](https://user-images.githubusercontent.com/81727895/236690191-c6b9a131-9179-4cb9-9267-44e395b669b2.png)


**μ¤ν”„λ§μ€ μ‚¬μ©μ κµ¬μ„±μ •λ³΄μ™€ μλ™ κµ¬μ„±μ •λ³΄λ¥Ό ν†µν•΄ ν•„μ”ν• κµ¬μ„±μ •λ³΄λ¥Ό μ½μ–΄μ¨λ‹¤.** 

### **4-2-3. @Importλ΅ μ»΄ν¬λ„νΈλ¥Ό κµ¬μ„±μ •λ³΄μ— μ¶”κ°€ν•κΈ°**

```
java
    γ„΄ config
        γ„΄ Config.java
    γ„΄ tobyspring
        γ„΄ helloboot
            γ„΄ HelloBootApplication
            γ„΄ @RwkSpringBootAnnotation
...
```

κµ¬μ„±κ³Ό κ΄€λ ¨λ Config.javaμ™€ κ°™μ€ ν΄λμ¤λ“¤μ„ configλΌλ” ν¨ν‚¤μ§€μ— λ”°λ΅ λ¶„λ¦¬ν• λ’¤, μ‹¤ν–‰μ‹ν‚¤λ©΄ λ‹¤μκ³Ό κ°™μ€ μ—λ¬κ°€ λ‚λ‹¤.

```
***************************
APPLICATION FAILED TO START
***************************
```

μ΄μ λ” HelloBootApplicationμ— μλ” @RwkSpringBootApplicationμ @ComponentScan λ²”μ„λ¥Ό λ²—μ–΄λ‚«κΈ° λ•λ¬Έμ΄λ‹¤.


μ΄λ΄ κ²½μ°, @Import μ–΄λ…Έν…μ΄μ…μ„ ν†µν•΄ κµ¬μ„±μ •λ³΄μ— ν•„μ”ν• Classλ¥Ό λ¶λ¬μ¬ μ μλ‹¤.


```java
@Retention(RetentionPolicy.RUNTIME)
@Target(ElementType.TYPE)
@Configuration
@ComponentScan
@Import(Config.class)
public @interface RwkSpringBootAnnotation {
}
```
- λ‹¨, Importμ— λ“¤μ–΄κ° classλ” @Component μ–΄λ…Έν…μ΄μ…μ΄ μλ” classκ±°λ‚, @Componentμ λ©”νƒ€ μ–΄λ…Έν…μ΄μ…μ΄ μλ” classμ—¬μ•Ό ν•λ‹¤.

- μ¶λ ¥ κ²°κ³Ό

```
...
======== ServletWebServerFactory register =========
...
======== DispatcherServlet register =========
...
```

@Import μ–΄λ…Έν…μ΄μ…μΌλ΅ κµ¬μ„±μ •λ³΄λ¥Ό import ν• λ’¤, λ‹¤μ‹ μ •μƒμ μΌλ΅ μ‹¤ν–‰λλ” κ²ƒμ„ ν™•μΈ ν•  μ μλ‹¤.

**π¤” Importν•΄μ•Όν•  ν΄λμ¤λ“¤μ μΆ…λ¥κ°€ λ§μ•„μ§ κ²½μ°, ν•λ‚ν•λ‚ @Import μ•μ— μ¶”κ°€ν•κΈ° λ¶νΈν•΄μ§ν…λ° μ΄λ΄ κ²½μ°μ—λ” μ–΄λ–»κ² ν•΄μ•Ό ν•λ‚μ”?**

```java
public interface ImportSelector {
    String[] selectImports(AnnotationMetadata importingClassMetadata);

    @Nullable
    default Predicate<String> getExclusionFilter() {
        return null;
    }
}
```

μ¤ν”„λ§μ— μλ” ImportSelector μΈν„°νμ΄μ¤λ¥Ό ν™μ©ν•μ—¬ μ—¬λ¬ κ°λ¥Ό import ν•  μ μλ‹¤.


```java
public interface DeferredImportSelector extends ImportSelector
```


### **4-2-4. DeferredImportSelectorλ¥Ό κµ¬ν„ν•μ—¬ selectImports λ©”μ„λ“ μ‘μ„±ν•κΈ°**

**1. tobyspring.config.RwkAutoConfiguration.java**

```java
@Retention(RetentionPolicy.RUNTIME)
@Target(ElementType.TYPE)
@Configuration
public @interface RwkAutoConfiguration {
}
```


**2. resources/META-INF/spring/tobyspinrg.config.RwkAutoConfiguration.imports**

```
tobyspring.config.autoconfig.DispatcherServletConfig
tobyspring.config.autoconfig.TomcatWebServerConfig
```

- import ν•  νμΌμ„ imports νμΌμ— μ‘μ„±ν•λ‹¤.

**3. package tobyspring.config.AutoConfigImportSelector.java**

```java
public class AutoConfigImportSelector implements DeferredImportSelector{

    private final ClassLoader classLoader;

    public AutoConfigImportSelector(ClassLoader classLoader){
        this.classLoader=classLoader;
    }

    @Override
    public String[] selectImports(AnnotationMetadata importingClassMetadata) {
        // ImportCandidates::load -> imports νμΌμ— μλ” ν΄λμ¤λ“¤μ„ ν΄λμ¤ λ΅λ”λ΅ μ½μ–΄μ„ Iterableμ— μ €μ¥
        Iterable<String> candidates =ImportCandidates.load(RwkAutoConfiguration.class, classLoader);
        // new ν‚¤μ›λ“λ΅ μΈμ¤ν„΄μ¤ 
        return StreamSupport.stream(candidates.spliterator(), false).toArray(String[]::new);
    }
}
```

**4. tobyspring.helloboot.RwkSpringBootAnnotation.java**

```java
@Retention(RetentionPolicy.RUNTIME)
@Target(ElementType.TYPE)
@Configuration
@ComponentScan
@Import(AutoConfigImportSelector.class)
public @interface RwkSpringBootAnnotation {
}
```

- AutoConfigImportSelector ν΄λμ¤λ¥Ό import ν•΄μ¤€λ‹¤.

- μ¶λ ¥ κ²°κ³Ό

```
...
======== ServletWebServerFactory register =========
...
======== DispatcherServlet register =========
...
```

## **4.3. @Configurationκ³Ό proxyBeanMethods**

01.SpringBootμ‚΄ν΄λ³΄κΈ° νΈμ—μ„ μ‹±κΈ€ν†¤ λ μ§€μ¤νΈλ¦¬ μ–ΈκΈ‰μ„ ν–μ—λ‹¤.

```
μ¤ν”„λ§ μ• ν”λ¦¬μΌ€μ΄μ…μ—μ„λ” μ‹±κΈ€ν†¤ ν¨ν„΄κ³Ό μ μ‚¬ν•κ² μ• ν”λ¦¬μΌ€μ΄μ…μ΄ λ™μ‘ν•λ” λ™μ• λ”± ν•λ‚μ μ¤λΈμ νΈλ§μ„ λ§λ“¤κ³  μ‚¬μ©λκ² λ§λ“¤μ–΄ μ¤€λ‹¤. μ΄λ° λ©΄μ—μ„ μ¤ν”„λ§ μ»¨ν…μ΄λ„λ” μ‹±κΈ€ν†¤ λ μ§€μ¤νΈλ¦¬λΌκ³  ν•λ‹¤.
```

@Configuration μ–΄λ…Έν…μ΄μ…μ΄ λ¶™μ€ ν΄λμ¤μ κ° @Beanμ„ ν•­μƒ μ‹±κΈ€ν†¤μΌλ΅ μ μ§€ν•΄μ£Όλ”μ§€ ν…μ¤νΈλ¥Ό ν•΄λ³΄μ.

### **4.3.1. @Configuration μ‹±κΈ€ν†¤ ν…μ¤νΈ μμ **

- Common.java

```java
public class Common {
}
```


- ConfigurationTest.java 

```java
public class ConfigurationTest {
    @Configuration
    static class MyConfig {
        @Bean
        Common common() {
            return new Common();
        }

        @Bean
        Bean1 bean1() {
            return new Bean1(common());
        }

        @Bean
        Bean2 bean2() {
            return new Bean2(common());
        }
    }

    static class Bean1 {
        private final Common common;

        Bean1(Common common) {
            this.common = common;
        }
    }

    static class Bean2 {
        private final Common common;

        Bean2(Common common) {
            this.common = common;
        }
    }
}
```

λ‹¤μκ³Ό κ°™μ΄ ConfigurationTest ν΄λμ¤κ°€ κµ¬μ„±λμ–΄ μμ„ λ•, κ° μ‹±κΈ€ν†¤ λ μ§€μ¤νΈλ¦¬ ν…μ¤νΈ κ²°κ³Όλ” μ•„λμ™€ κ°™λ‹¤.

**1. MyConfig.classλ¥Ό ApplicationContextμ— λΉμΌλ΅ λ“±λ΅ ν›„, ν…μ¤νΈ**

```java
@Test
void configuration() {
    AnnotationConfigApplicationContext ac = new AnnotationConfigApplicationContext();
    ac.register(MyConfig.class);
    ac.refresh();

    Bean1 bean1 = ac.getBean(Bean1.class);
    Bean2 bean2 = ac.getBean(Bean2.class);

    // isSameAs : κ°™μ€ μ¤λΈμ νΈμΈμ§€ μ£Όμ†κ°’κΉμ§€ λΉ„κµ
    assertThat(bean1.common).isSameAs(bean2.common);
    // ν…μ¤νΈ ν†µκ³Ό
}
```

- ν…μ¤νΈ κ²°κ³Ό : μ„±κ³µ(λ‘ κ°μ²΄μ μ£Όμ†κ°’μ΄ κ°™μ)

**2. MyConfig.classλ¥Ό μΈμ¤ν„΄μ¤ ν• λ’¤μ—, κ° ν•¨μλ΅ λ¶€ν„° Bean1, Bean2 ν΄λμ¤ μ°Έμ΅°λ³€μλ¥Ό λ°›μ•„ μ¨ λ’¤, λΉ„κµ ν…μ¤νΈ**

```java
@Test
void configuration() {
    MyConfig myConfig = new MyConfig();
    Bean1 bean1 = myConfig.bean1();
    Bean2 bean2 = myConfig.bean2();

    assertThat(bean1.common).isSameAs(bean2.common);
}
```
- ν…μ¤νΈ κ²°κ³Ό : μ‹¤ν¨(λ‘ κ°μ²΄μ μ£Όμ†κ°’μ΄ λ‹¤λ¦„)


**3. MyConfig ν΄λμ¤λ¥Ό μƒμ†ν• MyConfigProxy ν΄λμ¤λ¥Ό μƒμ„±ν• λ’¤, μ‹±κΈ€ν†¤μΌλ΅ Common ν΄λμ¤ λ³€μ λ¦¬ν„΄ν–μ„ λ•, λΉ„κµ ν…μ¤νΈ**


```java
// μ¶”κ°€λ λ¶€λ¶„
static class MyConfigProxy extends MyConfig {
    private Common common;

    @Override
    Common common() {
        if (this.common == null) this.common = super.common();
             return this.common;
    }
}

@Test
void proxyCommonMethod() {
    MyConfigProxy myConfigProxy = new MyConfigProxy();
    Bean1 bean1 = myConfigProxy.bean1();
    Bean2 bean2 = myConfigProxy.bean2();
    assertThat(bean1.common).isSameAs(bean2.common);
    // ν…μ¤νΈ ν†µκ³Ό
}
```

- ν…μ¤νΈ κ²°κ³Ό : μ„±κ³µ(λ‘ κ°μ²΄μ μ£Όμ†κ°’μ΄ κ°™μ)


**β”οΈ μ¤ν”„λ§μ€ ν• κ°μ μ¤λΈμ νΈλ§ μ‚¬μ©ν•κ² λλ”λ°, λ§μ•½ ν•λ‚μ λΉμ„ λ‘ κ° μ΄μƒμ λ‹¤λ¥Έ λΉμ—μ„ μμ΅΄ν•κ³  μλ‹¤λ©΄ FactoryMethodλ¥Ό νΈμ¶ν•  λ•λ§λ‹¤, μƒλ΅μ΄ λΉμ΄ λ§λ“¤μ–΄μ§€λ” λ¬Έμ κ°€ μƒκΈ΄λ‹¤.**

> **μ¤ν”„λ§μ€ μ΄ λ¬Έμ λ¥Ό ν•΄κ²°ν•κΈ° μ„ν•΄ @Configurationμ΄ μ–΄λ…Έν…μ΄μ…μ΄ λ¶™μ€ ν΄λμ¤λ” κΈ°λ³Έμ μΌλ΅ Proxyλ¥Ό λ§λ“¤μ–΄μ„ μ΄λ¥Ό ν•΄κ²°ν•΄μ¤€λ‹¤.**

### **4.3.2. @Configuration(proxyBeanMethods = false)λ΅ μ„¤μ • ν›„, μ‹±κΈ€ν†¤ λ μ§€μ¤νΈλ¦¬ ν…μ¤νΈ**


μ΄ λ•, @Configuration(proxyBeanMethods = false)λ΅ μ„¤μ •ν–μ„ λ•, ν…μ¤νΈ κ²°κ³Όλ” μ•„λμ™€ κ°™λ‹¤.

```java
// μμ •λ λ¶€λ¶„
@Configuration(proxyBeanMethods = false)
static class MyConfig {
    ...
}
```

```
**ν…μ¤νΈ 1 : μ‹¤ν¨ (λ‘ μ£Όμ†κ°’μ΄ λ‹¤λ¦„)**

ν…μ¤νΈ 2 : μ‹¤ν¨ (λ‘ μ£Όμ†κ°’μ΄ λ‹¤λ¦„)

ν…μ¤νΈ 3 : μ„±κ³µ (λ‘ μ£Όμ†κ°’μ΄ κ°™μ)
```

μ°¨μ΄λ” MyConfig.classλ¥Ό ApplicationContextμ— λΉμΌλ΅ λ“±λ΅ ν›„, ν…μ¤νΈν•μ€μ„ λ•, proxyBeanMethods = true μ€μ„ μ‹μ—λ” μ„±κ³µμ΄μ€λ”λ°, falseλ΅ λ°”κΎΈμ μ‹¤ν¨ν•μ€λ‹¤.

μ΄μ λ” @Configurationμ΄ λ¶™μ€ ν΄λμ¤λ¥Ό λΉμΌλ΅ λ“±λ΅ ν•  λ•, Proxyλ¥Ό λ§λ“¤μ§€ μ•κ³ , μλ°” μ½”λ“ κ·Έλ€λ΅ λ™μ‘ν•κ² λ§λ“¤μ—κΈ° λ•λ¬Έμ΄λ‹¤.

### **4.3.3. @Configuration(proxyBeanMethods = false)λ΅ μ‹¤μ  ν™μ© μμ‹**

- @EnableScheduling

```java
@Target({ElementType.TYPE})
@Retention(RetentionPolicy.RUNTIME)
@Import({SchedulingConfiguration.class})
@Documented
public @interface EnableScheduling {
}
```

- SchedulingConfiguration.class

```java
@Configuration(
    proxyBeanMethods = false
)
@Role(2)
public class SchedulingConfiguration {
    public SchedulingConfiguration() {
    }

    @Bean(
        name = {"org.springframework.context.annotation.internalScheduledAnnotationProcessor"}
    )
    @Role(2)
    public ScheduledAnnotationBeanPostProcessor scheduledAnnotationProcessor() {
        return new ScheduledAnnotationBeanPostProcessor();
    }
}
```

SchedulingConfiguration μ†μ¤ μ½”λ“λ¥Ό λ³΄λ©΄, Beanμ„ ν•λ‚ μƒμ„±ν•λ” μ½”λ“κ°€ μλ”λ°, 

ν•΄λ‹Ή Beanμ€ μƒμ„±ν•λ” λ™μ•μ—, λ‹¤λ¥Έ μ¤λΈμ νΈλ¥Ό μμ΅΄ν•κ³  μμ§€ μ•λ‹¤.

μ΄λ° κ²½μ°, λ§¤λ² Proxyλ¥Ό λ§λ“¤μ–΄μ„ μ μ©ν•   ν•„μ”κ°€ μ—†λ‹¤κ³  νλ‹¨ν•μ—¬ proxyBeanMethodsλ¥Ό falseλ΅ μ„¤μ •ν• μΌ€μ΄μ¤μ΄λ‹¤.

## **4.4. @Conditionalκ³Ό Condition**































